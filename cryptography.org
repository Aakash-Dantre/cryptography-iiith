#+TITLE: Integration Notes on Cryptography Virtual Lab (IIIT-Hyderabad)
#+Date: <2013-04-08 Mon>
#+Author: Swathy, Pranitha 

* Introduction

This document describes the integration process for Cryptography
lab. The integration process follows [[./integration-plan.org][these steps]].


* Lab Dependencies

** Test

Apache2, PHP


** Deploy

Apache2, PHP


** Interfaces

*** Development Phase

Not known

*** Build Phase

Lab Sources + make ==> Build


*** Test

Build + php + apache ==> working lab


*** Deploy

Build + php + apache ==> working lab
   

* Test Container Specification 

Location: Base 2

Container ID : 196

FQDN: test-cryptography.virtual-labs.ac.in

IP: 10.4.12.196

OS: Ubuntu 12.04

RAM: 256 MB

Swap: 512 MB (Virtual)

Disk space: 5 GB

Primary Admin: Swathy, Pranitha

Packages Installed: PHP5, Apache2 (updated)


* Deploy Container Specification 

Location: Base 2

Container ID : 174

FQDN: cryptography.virtual-labs.ac.in

IP: 10.4.12.174

OS: Ubuntu 12.04

RAM: 256 MB

Swap: 512 MB (Virtual)

Disk space: 5 GB

Primary Admin: Swathy, Pranitha

Packages Installed: PHP5, Apache2 (updated)


* Steps Involved in Integration
  
** Sources

- check out the sources from version control repository

svn co http://svn.virtual-labs.ac.in/cse29/cse29 --username [username]
 

** Manual Build Process

- make file already exists


** Automated Build Process

- change directory to src folder in the lab sources: cd src/

- run command: make all 

build directory gets generated in the lab sources at first level

- come out of the current directory by running the command cd..

- copy the build directory to localhost: cp -r build/ /var/www


** Automated Scripts for the Lab

Q. Where should the scripts run from?

A. They are running from the scripts folder of the lab.  The scripts
are committed in the lab sources. 

*** Init Script

- installs dependencies, runs the make file and creates the build

- dependecies.txt is the file where all the packages required to run
  the labs should be entered

- init.sh takes the dependecies.txt as an input and installs all the
  required software

- automatically runs the make file, builds the lab and copies the lab
  to /var/www


**** Usage

- init is a shell script. it should be invoked using the following command:

#+begin_src

sh scripts/init.sh scripts/dependencies.txt

#+end_src


*** Startup Script

- starts the services required to run the lab 

- does an apache restart

**** Usage

- invoke the script using the following command:

#+begin_src

sh scripts/startup.sh 

#+end_src


*** Shutdown Script

- shuts down the services 

- stops the apache2 

**** Usage

- invoke the script using the following command:

#+begin_src

sh scripts/shutdown.sh

#+end_src


*** Backup and Restore Script

- are empty for this lab as there is no database involved 




* How to deploy the lab?
  
** create a container

- follow this documentation to create the container - [[https://vlead.virtual-labs.ac.in/wiki/index.php/Creating_new_container][How to Create a Container]]

- set the nameserver

- set the diskspace of the container to 5G

- start the container

- enter the container

- set the password for the container

- edit the /etc/bash.bashrc file to include the proxy server address


** login to the container 

- run: apt-get update

- install subversion: apt-get install -y subversion


** check out the sources

svn co http://svn.virtual-labs.ac.in/cse29/cse29 --username [username]

# checkout script has been created. where should it be placed?
# permissions for scripts folder in the lab sources has to be changed
# to 777
# path to point to the scripts folder should be edited

** cd to the lab sources folder

- run : cd cse29 (on the current machine)


** run the init script

- run : sh scripts/init.sh scripts/dependencies.txt


** run the startup script

run : sh scripts/startup.sh
